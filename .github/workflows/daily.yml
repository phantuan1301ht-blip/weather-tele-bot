name: GPS Weather Watch (VN 07:30-21:00)

on:
  schedule:
    # 07:30, 07:45 VN  (00:30, 00:45 UTC)
    - cron: "30,45 0 * * *"
    # 08:00 -> 20:45 VN (01:00 -> 13:45 UTC) every 15 min
    - cron: "*/15 1-13 * * *"
    # 21:00 VN (14:00 UTC)
    - cron: "0 14 * * *"
  workflow_dispatch:

jobs:
  run:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install deps
        run: pip install requests

      # Cache state file để giữ cooldown 3 giờ qua các lần chạy
      - name: Restore state cache
        uses: actions/cache@v4
        with:
          path: .state
          key: gps-weather-state-v1

      - name: Run watcher
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          # URL Worker của bạn (đang có /get?device_id=phone1)
          WORKER_BASE_URL: "https://wispy-recipe-e63f.bbgaming4-vn.workers.dev"
          DEVICE_ID: "phone1"
        run: python weather_forecast_gps.py
